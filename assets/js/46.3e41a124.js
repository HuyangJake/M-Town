(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{328:function(t,s,n){"use strict";n.r(s);var a=n(0),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("p",[t._v("在iOS设备中运行python脚本？那不就意味着可以在手机上跑爬虫，可以使用各种牛逼哄哄的python库了吗。")]),t._v(" "),n("p",[t._v("这个标题对我很有吸引力，曾经就有见到过在iOS平台上的python编译器(很多iOS上python的IDE，如"),n("a",{attrs:{href:"https://itunes.apple.com/cn/app/python3ide/id1357215444?mt=8",target:"_blank",rel:"noopener noreferrer"}},[t._v("Python3IDE"),n("OutboundLink")],1),t._v(")，可以执行输入的python语和本地的python文件。")]),t._v(" "),n("p",[t._v("当然我想要的不是像"),n("a",{attrs:{href:"https://segmentfault.com/a/1190000004945692",target:"_blank",rel:"noopener noreferrer"}},[t._v("这篇文章"),n("OutboundLink")],1),t._v("说的用python编写一整个iOS程序，而只是在iOS应用中嵌入python文件执行非UI的逻辑，也就是说只需要在项目中嵌入一个python的编译环境。")]),t._v(" "),n("p",[t._v("面对市场上这么多的iOS版python编译器，首先可以确定的是，针对iOS端的python编译库是存在的。我关心的问题是，能否支持python项目化的编译，能否导入丰富的三方库。那就动手一试咯")]),t._v(" "),n("h2",{attrs:{id:"小目标"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#小目标"}},[t._v("#")]),t._v(" 小目标")]),t._v(" "),n("p",[t._v("七牛的iOS平台SDK有这样一个特点，上传文件的时候需要生成token，但是生成token的逻辑在客户端的SDK中不存在，只能通过调用服务端的SDK才能获得。\n于是我们的小目标就诞生了：在iOS端上调用七牛python服务端SDK来生成token给客户端的七牛SDK使用。")]),t._v(" "),n("hr"),t._v(" "),n("h2",{attrs:{id:"ios的python解释器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ios的python解释器"}},[t._v("#")]),t._v(" iOS的Python解释器")]),t._v(" "),n("p",[t._v("针对iOS、MacOS平台，"),n("a",{attrs:{href:"https://pybee.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("pybee"),n("OutboundLink")],1),t._v("开源了python支持库"),n("a",{attrs:{href:"https://github.com/pybee/Python-Apple-support",target:"_blank",rel:"noopener noreferrer"}},[t._v("Python-Apple-support"),n("OutboundLink")],1),t._v("，这个是老版本的库"),n("a",{attrs:{href:"https://github.com/pybee/Python-iOS-support",target:"_blank",rel:"noopener noreferrer"}},[t._v("Python-iOS-support"),n("OutboundLink")],1),t._v(".")]),t._v(" "),n("h3",{attrs:{id:"准备编译环境"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#准备编译环境"}},[t._v("#")]),t._v(" 准备编译环境")]),t._v(" "),n("p",[t._v("我这次使用的是老库中的"),n("a",{attrs:{href:"https://github.com/pybee/Python-iOS-support/releases/download/3.4.2-b5/Python-3.4.2-iOS-support.b5.tar.gz",target:"_blank",rel:"noopener noreferrer"}},[t._v("Python3.4.2-b5"),n("OutboundLink")],1),t._v("版本，下载下来有两个framework，分别是"),n("code",[t._v("OpenSSL")]),t._v("和"),n("code",[t._v("Python")]),t._v("。将这个两个framework拖入项目中，添加必要的lib库如图：\n"),n("img",{attrs:{src:"http://qiniu.huyangjie.cn/15359053297417.jpg",alt:""}})]),t._v(" "),n("p",[t._v("在项目中创建"),n("code",[t._v("PythonEnvironment.bundle")]),t._v("将"),n("code",[t._v("Python.framework")]),t._v("中的"),n("code",[t._v("Resources")]),t._v("文件夹内容复制进去，在初始化Python环境之前将bundle中的文件复制到指定目录作为Home路径")]),t._v(" "),n("h3",{attrs:{id:"设置home路径、初始化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#设置home路径、初始化"}},[t._v("#")]),t._v(" 设置Home路径、初始化")]),t._v(" "),n("p",[t._v("设置上面准备home路径，并初始化编译环境。")]),t._v(" "),n("div",{staticClass:"language-objectivec line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-objectivec"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" frameworkPath "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NSString stringWithFormat"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"%@/Resources"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),t._v(" p_pythonFrameworkPath"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" UTF8String"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nwchar_t  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("pythonHome "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("_Py_char2wchar")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("frameworkPath"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Py_SetPythonHome")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pythonHome"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Py_Initialize")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("PyEval_InitThreads")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//在释放的时候调用")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Py_Finalize")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br")])]),n("h3",{attrs:{id:"执行python代码、文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#执行python代码、文件"}},[t._v("#")]),t._v(" 执行Python代码、文件")]),t._v(" "),n("p",[t._v("编译环境设置好之后，使用"),n("code",[t._v("PyRun_SimpleString(python_code)")]),t._v("便可以简单执行Python代码")]),t._v(" "),n("div",{staticClass:"language-objectivec line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-objectivec"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("PyRun_SimpleString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"print('hello world')\"")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("p",[t._v("便可以输出"),n("code",[t._v("hello world")])]),t._v(" "),n("h4",{attrs:{id:"执行python文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#执行python文件"}},[t._v("#")]),t._v(" 执行Python文件")]),t._v(" "),n("div",{staticClass:"language-objectivec line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-objectivec"}},[n("code",[t._v("NSString "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("scriptPath "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NSBundle mainBundle"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" pathForResource"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"test"')]),t._v(" ofType"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"py"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \nFILE "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("mainFile "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("fopen")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("scriptPath UTF8String"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"r"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   \n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("PyRun_SimpleFile")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mainFile"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("scriptPath lastPathComponent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" UTF8String"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br")])]),n("p",[t._v("上面是执行main bundle中的Python文件方式，这种方式暂时没有找到如何调用文件中的某各类具体方法和传参。")]),t._v(" "),n("p",[t._v("另外一种方式可以做到上面描述的需求，将在下一节中说明")]),t._v(" "),n("hr"),t._v(" "),n("h2",{attrs:{id:"准备七牛python库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#准备七牛python库"}},[t._v("#")]),t._v(" 准备七牛Python库")]),t._v(" "),n("p",[t._v("下载好的七牛SDK文件源码解压，在Xcode中创建一个bundle加入项目中，bundle中放七牛SDK的核心文件，如图：\n"),n("img",{attrs:{src:"http://qiniu.huyangjie.cn/15359397140219.jpg",alt:""}})]),t._v(" "),n("p",[t._v("在需要使用七牛SDK之前，将此bundle中的文件拷贝到Python运行环境的home目录下")]),t._v(" "),n("h3",{attrs:{id:"编写token生成python文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#编写token生成python文件"}},[t._v("#")]),t._v(" 编写token生成Python文件")]),t._v(" "),n("p",[t._v("查看七牛的文档了解到生成token需要用到"),n("code",[t._v("auth.py")]),t._v("这个文件中的"),n("code",[t._v("Auth")]),t._v("类， 我们需要想办法创建一个"),n("code",[t._v("Auth")]),t._v("实例并传入需要的参数，再将生成的token导出来。")]),t._v(" "),n("p",[t._v("首先自己创建一个"),n("code",[t._v("iostoken.py")]),t._v("文件，Python的文件名和方法名需要小写，类名需要大写。在"),n("code",[t._v("iostoken.py")]),t._v("中创建"),n("code",[t._v("TokenForiOS")]),t._v("类")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" json\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" qiniu "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Auth\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TokenForiOS")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("object")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    \n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("create_token")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("jsonParams"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("str")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("jsonParams"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        values "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loads"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("jsonParams"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        access_key "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" values"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'access_key'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        secret_key "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" values"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'secret_key'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#要上传的空间")]),t._v("\n        bucket_name "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" values"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bucket_name'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#上传到七牛后保存的文件名")]),t._v("\n        file_name "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" values"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'file_name'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#构建鉴权对象")]),t._v("\n        q "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Auth"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("access_key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" secret_key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#生成上传 Token，可以指定过期时间等")]),t._v("\n        token "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" q"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("upload_token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bucket_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" file_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3600")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" token\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br")])]),n("p",[t._v("上面是我使用七牛SDK中的Auth生成token的代码，类名为"),n("code",[t._v("TokenForiOS")]),t._v("方法名为"),n("code",[t._v("create_token")]),t._v("，现在需要找到合适的地方调用。")]),t._v(" "),n("p",[t._v("不过在想要使用"),n("code",[t._v("TokenForiOS")]),t._v("类之前，需要将其加入"),n("code",[t._v("qiniu")]),t._v("模块的初始化"),n("code",[t._v("__init__.py")]),t._v("中：")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("iostoken "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" TokenForiOS\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("p",[t._v("接下来就可以愉快地调用了")]),t._v(" "),n("p",[n("code",[t._v("Python.framework")]),t._v("中有一套宏可以导入Python模块，生成实例，传参调用方法，具体使用例子见下代码块")]),t._v(" "),n("div",{staticClass:"language-objectivec line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-objectivec"}},[n("code",[t._v("\nPyObject "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("pModule "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("PyImport_ImportModule")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"qiniu.iostoken"')]),t._v(" UTF8String"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//导入模块")]),t._v("\n    \nPyObject "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("pyClass "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("PyObject_GetAttrString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pModule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"TokenForiOS"')]),t._v(" UTF8String"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取类")]),t._v("\n    \nPyObject "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("pyInstance "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("PyInstanceMethod_New")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pyClass"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//创建实例")]),t._v("\n    \nNSMutableDictionary "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("params "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NSMutableDictionary new"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("params setObject"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"123"')]),t._v(" forKey"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"access_key"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("params setObject"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"456"')]),t._v(" forKey"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"secret_key"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("params setObject"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"jake"')]),t._v(" forKey"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"bucket_name"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("params setObject"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"pic"')]),t._v(" forKey"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"file_name"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \nNSError "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("error "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nil"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nNSData "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("jsonData "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NSJSONSerialization dataWithJSONObject"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("params options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("NSJSONWritingPrettyPrinted error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nNSString "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("paramterJsonString "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NSString alloc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" initWithData"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("jsonData encoding"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("NSUTF8StringEncoding"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \nPyObject "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("result "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nresult "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("PyObject_CallMethod")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pyInstance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"create_token"')]),t._v(" UTF8String"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"(s)"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("paramterJsonString UTF8String"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" resultCString "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("PyArg_Parse")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"s"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("resultCString"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//将python类型的返回值转换为c")]),t._v("\n    \n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("NSLog")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"%s"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" resultCString"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br")])]),n("p",[t._v("至此，我的小目标就完成啦。后面还有很多事情可以做，比如跑个爬虫试试，毕竟还没有尝试过网络请求。当然也还有很多坑要踩。")]),t._v(" "),n("hr"),t._v(" "),n("h2",{attrs:{id:"总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),n("p",[t._v("使用过程中有下面几点体会")]),t._v(" "),n("ul",[n("li",[n("s",[n("code",[t._v("Python-Apple-support")]),t._v("库的缺少文档")]),t._v(" 查看Python的c-api库：https://docs.python.org/3.5/c-api/ ，在设置Home目录导入模块的过程中踩了很多坑")]),t._v(" "),n("li",[t._v("编译器对Python语法提示并不支持，难以排查写错的地方")]),t._v(" "),n("li",[t._v("framework的体积是在过大，对项目总体积影响大")])]),t._v(" "),n("hr"),t._v(" "),n("p",[t._v("PS:在查询过程中发现了"),n("a",{attrs:{href:"https://pythonhosted.org/pyobjc/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("PyObjc"),n("OutboundLink")],1),t._v("这个项目，能够使用python通过bridge调用OC的方法从而使用Cocoa框架，实现使用python编写Cocoa GUI应用。")]),t._v(" "),n("blockquote",[n("p",[t._v("PyObjC is a bridge between Python and Objective-C. It allows Python scripts to use and extend existing Objective-C class libraries; most importantly the Cocoa libraries by Apple.")])]),t._v(" "),n("blockquote",[n("p",[t._v("This document describes how to use Objective-C class libraries from Python scripts and how to interpret the documentation of those libraries from the point of view of a Python programmer.")])]),t._v(" "),n("hr"),t._v(" "),n("h2",{attrs:{id:"reference"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#reference"}},[t._v("#")]),t._v(" Reference")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://blog.csdn.net/haojinming/article/details/77816403",target:"_blank",rel:"noopener noreferrer"}},[t._v("在iOS app中运行Python文件（Swift+Objective C+Python) 带Demo"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://www.jianshu.com/p/80b5be51fb1d",target:"_blank",rel:"noopener noreferrer"}},[t._v("iOS 工程中调用Python方法（带Demo）"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://stackoverflow.com/questions/3691655/embedding-python-in-an-iphone-app",target:"_blank",rel:"noopener noreferrer"}},[t._v("Embedding Python in an iPhone app"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://pythonhosted.org/pyobjc/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("PyObjc"),n("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=e.exports}}]);