(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{344:function(t,s,a){"use strict";a.r(s);var e=a(0),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"背景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[t._v("#")]),t._v(" 背景")]),t._v(" "),a("p",[t._v("项目中用到了本地登录存储cookie，再进行webView请求时间带上cookie的功能。不是很清晰逻辑，于是学习了解了下iOS中cookie的使用，做个小结。跳过概念直接看"),a("a",{attrs:{href:"#example"}},[t._v("使用🌰")])]),t._v(" "),a("h2",{attrs:{id:"cookie介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cookie介绍"}},[t._v("#")]),t._v(" Cookie介绍")]),t._v(" "),a("p",[t._v("Cookie分类两类：")]),t._v(" "),a("ul",[a("li",[t._v("会话cookie")]),t._v(" "),a("li",[t._v("持久cookie")])]),t._v(" "),a("p",[t._v("会话 cookie 和持久 cookie 之间唯一的区别就是它们的过期时间。")]),t._v(" "),a("p",[a("strong",[t._v("cookie如何工作")])]),t._v(" "),a("p",[t._v("cookie 中包含了一个由 名字 = 值 （name=value） 这样的信息构成的任意列表，并通过 Set-Cookie 或 Set-Cookie2 HTTP 响应（扩 展）首部将其贴到用户身上去。\n"),a("img",{attrs:{src:"http://qiniu.huyangjie.cn/coldreading/jpg/cookie%E5%B7%A5%E4%BD%9C.png-blog",alt:"cookie工作"}})]),t._v(" "),a("p",[a("strong",[t._v("cookie组成")]),t._v("\n现在使用的 cookie 规范有两个不同的版本：cookies 版本 0（有时被称为 Netscape cookies） 和 cookies 版 本 1（RFC 2965） 。 cookies 版 本 1 是 对 cookies 版 本 0 的 扩 展，应用不如后者广泛。")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("cookie版本0")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("Set-Cookie 首部\nSet-Cookie 首部有一个强制性的cookie名和cookie值。后面跟着可选的cookie 属性，中间由分号分隔。\n"),a("img",{attrs:{src:"http://qiniu.huyangjie.cn/coldreading/jpg/setcookie%E9%A6%96%E9%83%A81.png-blog",alt:""}}),t._v(" "),a("img",{attrs:{src:"http://qiniu.huyangjie.cn/coldreading/jpg/setcookie%E9%A6%96%E9%83%A82.png-blog",alt:""}})])]),t._v(" "),a("li",[a("p",[t._v("cookie 0首部:")])])])])]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Cookie: session-id=002-1145265-8016838; session-id-time=1007884800\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("ul",[a("li",[a("strong",[t._v("cookie版本1")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("Set-Cookie2首部\n这个版本 1 标准引入了Set-Cookie2首部和Cookie2首部，但它也能于版本0进行交互操作。\n"),a("img",{attrs:{src:"http://qiniu.huyangjie.cn/coldreading/jpg/setcookie2%E9%A6%96%E9%83%A8.png-blog",alt:""}})])]),t._v(" "),a("li",[a("p",[t._v("cookie 1首部:")])])])])]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('Cookie: $Version="1";\nID="29046"; $Domain=".joes-hardware.com";\ncolor="blue";\nCoupon="hammer027"; $Path="/tools";\nCoupon="handvac103"; $Path="/tools/cordless"\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("h2",{attrs:{id:"nshttpcookiestorage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nshttpcookiestorage"}},[t._v("#")]),t._v(" NSHTTPCookieStorage")]),t._v(" "),a("blockquote",[a("p",[t._v("NSHTTPCookieStorage implements a singleton object (shared instance) that manages storage of cookies. Each cookie is represented by an instance of the NSHTTPCookie class. As a rule, cookies are shared among all applications and are kept in sync across process boundaries. Session cookies (where the cookie object’s sessionOnly method returns YES) are local to a single process and are not shared.")])]),t._v(" "),a("p",[a("code",[t._v("NSHTTPCookieStorage")]),t._v("的实现是一个单例对象，管理着"),a("code",[t._v("NSHTTPCookie")]),t._v("对象，会话cookie的 "),a("code",[t._v("sessionOnly")]),t._v("方法返回"),a("code",[t._v("YES")]),t._v("就不可在进程间共享。")]),t._v(" "),a("p",[t._v("然而苹果在这个类的API Reference中写了一个"),a("code",[t._v("iOS Note")]),t._v("：")]),t._v(" "),a("blockquote",[a("p",[t._v("Cookies are not shared among applications in iOS.")])]),t._v(" "),a("ul",[a("li",[a("p",[t._v("__iOS__中cookie不能跨应用共享")])]),t._v(" "),a("li",[a("p",[t._v("__MacOS__中"),a("code",[t._v("sessionOnly")]),t._v("不为"),a("code",[t._v("YES")]),t._v("是可以被共享的")])])]),t._v(" "),a("p",[a("code",[t._v("NSHTTPCookieStorage")]),t._v("可以管理cookie的接受策略，在一个app中改变cookie的接受策略将会影响其他正在运行的app的cookie接受策略。")]),t._v(" "),a("p",[t._v("当其他的app修改了cookie存储 或者 cookie接受策略，NSHTTPCookieStorage将会给app发送"),a("code",[t._v("NSHTTPCookieManagerCookiesChangedNotification")]),t._v("或者"),a("code",[t._v("NSHTTPCookieStorageAcceptPolicyChangedNotification")]),t._v("通知")]),t._v(" "),a("p",[a("strong",[t._v("Cookie接受策略：")]),t._v(" "),a("code",[t._v("NSHTTPCookieAcceptPolicy")])]),t._v(" "),a("div",{staticClass:"language-objectivec line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-objectivec"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typedef")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("NS_ENUM")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("NSUInteger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" NSHTTPCookieAcceptPolicy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    NSHTTPCookieAcceptPolicyAlways"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//默认策略，接受所有的cookies")]),t._v("\n    NSHTTPCookieAcceptPolicyNever"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//拒绝所有的cookies")]),t._v("\n    NSHTTPCookieAcceptPolicyOnlyFromMainDocumentDomain"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//只从主文档域名接受cookies")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("h2",{attrs:{id:"nshttpcookie"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nshttpcookie"}},[t._v("#")]),t._v(" NSHTTPCookie")]),t._v(" "),a("blockquote",[a("p",[t._v("An NSHTTPCookie object represents an HTTP cookie. It is an immutable object, initialized from a dictionary containing the cookie attributes.")])]),t._v(" "),a("p",[a("code",[t._v("NSHTTPCookie")]),t._v("对象中包含了HTTP 的cookie对象，从包含cookie字段的字典初始化创建。")]),t._v(" "),a("blockquote",[a("p",[t._v("The NSHTTPCookie class encapsulates a cookie, providing accessors for many of the common cookie attributes. This class also provides methods to convert HTTP cookie headers to NSHTTPCookie instances and convert an NSHTTPCookie instance to headers suitable for use with an NSURLRequest object. The URL loading system automatically sends any stored cookies appropriate for an NSURLRequest object unless the request specifies not to send cookies. Likewise, cookies returned in an NSURLResponse object are accepted in accordance with the current cookie acceptance policy.")])]),t._v(" "),a("p",[a("code",[t._v("NSHTTPCookie")]),t._v("类封装了一个HTTP Cookie，并提供常见的Cookie属性访问接口。"),a("code",[t._v("NSHTTPCookie")]),t._v("可以转换HTTP Cookie成NSHTTPCookies对象，并可以将NSHTTPCookie对象转化为NSURLRequest对象的请求头部分。URL loading system 会自动地给NSURLRequest对象发送存储的cookie，除非NSURLRequest对象指定不需要传cookie，同样cookie在NSURLRequest中返回也按照当前的cookie接受策略接收。")]),t._v(" "),a("h2",{attrs:{id:"cookie使用💪个🌰"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cookie使用💪个🌰"}},[t._v("#")]),t._v(" "),a("span",{attrs:{id:"example"}},[t._v("Cookie使用💪个🌰")])]),t._v(" "),a("p",[t._v("Cookie生成的有两个途径，一个是访问一个网页，这个网页返回的HTTP Header中有Set-Cookie指令进行Cookie的设置，这里Cookie的本地处理其实是由WebKit进行的；还有一种途径就是客户端通过代码手动设置Cookie。")]),t._v(" "),a("p",[t._v("值得注意"),a("a",{attrs:{href:"http://geeklu.com/2013/04/ios-cookie/",target:"_blank",rel:"noopener noreferrer"}},[t._v("iOS Cookie使用"),a("OutboundLink")],1),t._v("提到：\nNSHTTPCookieStorage存在一个问题，setCookie或者deleteCookie后并不会立即进行持久化，而是有几秒的延迟。为了可靠性，我们会将cookie信息保存一份到User Defaults，需要用的时候load进来。")]),t._v(" "),a("ul",[a("li",[t._v("客户端手动设置Cookie")])]),t._v(" "),a("div",{staticClass:"language-objectivec line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-objectivec"}},[a("code",[t._v("NSMutableDictionary "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("cookieProperties "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NSMutableDictionary dictionary"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("cookieProperties setObject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"name"')]),t._v(" forKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("NSHTTPCookieName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("cookieProperties setObject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"value"')]),t._v(" forKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("NSHTTPCookieValue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("cookieProperties setObject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"www.taobao.com"')]),t._v(" forKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("NSHTTPCookieDomain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("cookieProperties setObject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"/"')]),t._v(" forKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("NSHTTPCookiePath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("cookieProperties setObject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"0"')]),t._v(" forKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("NSHTTPCookieVersion"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("cookieProperties setObject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"30000"')]),t._v(" forKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("NSHTTPCookieMaximumAge"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nNSHTTPCookie "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("cookie "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NSHTTPCookie cookieWithProperties"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("cookieProperties"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NSHTTPCookieStorage sharedHTTPCookieStorage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" setCookie"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("cookie"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//删除cookie的方法为deleteCookie:")]),t._v("\n\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])]),a("p",[t._v("在通过setCookie:进行设置cookie的时候，会覆盖name,domain,path都相同的cookie的。\n至于cookie会不会持久化到cookie文件中主要看这个cookie的生命周期，和Max-Age或者Expires有关。")]),t._v(" "),a("ul",[a("li",[t._v("通过HTTP Header的Set-Cookie后者Set-Cookie2设置Cookie")])]),t._v(" "),a("div",{staticClass:"language-objectivec line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-objectivec"}},[a("code",[t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//请求一个网址，即可分配到cookie")]),t._v("\n    AFHTTPRequestOperationManager "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("manager "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("AFHTTPRequestOperationManager manager"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    manager"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("responseSerializer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("AFJSONResponseSerializer new"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("manager GET"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("urlString parameters"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("nil success"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("AFHTTPRequestOperation "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("operation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" id responseObject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n \n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取cookie")]),t._v("\n        NSArray "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("cookies "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NSHTTPCookieStorage sharedHTTPCookieStorage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" cookies"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        \n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*\n         * 把cookie进行归档并转换为NSData类型\n         * 注意：cookie不能直接转换为NSData类型，否则会引起崩溃。\n         * 所以先进行归档处理，再转换为Data\n         */")]),t._v("\n        NSData "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("cookiesData "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NSKeyedArchiver archivedDataWithRootObject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NSHTTPCookieStorage sharedHTTPCookieStorage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" cookies"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n \n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//存储归档后的cookie")]),t._v("\n        NSUserDefaults "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("userDefaults "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NSUserDefaults standardUserDefaults"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("userDefaults setObject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cookiesData forKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"cookie"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),t._v(" setCookie"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" failure"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("AFHTTPRequestOperation "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("operation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" NSError "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("setCookie\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//取出保存的cookie")]),t._v("\n    NSUserDefaults "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("userDefaults "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NSUserDefaults standardUserDefaults"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//对取出的cookie进行反归档处理")]),t._v("\n    NSArray "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("cookies "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NSKeyedUnarchiver unarchiveObjectWithData"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("userDefaults objectForKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"cookie"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n \n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cookies"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//设置cookie")]),t._v("\n        NSHTTPCookieStorage "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("cookieStorage "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NSHTTPCookieStorage sharedHTTPCookieStorage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id cookie "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" cookies"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("cookieStorage setCookie"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("NSHTTPCookie "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("cookie"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("NSLog")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"无cookie"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br"),a("span",{staticClass:"line-number"},[t._v("33")]),a("br"),a("span",{staticClass:"line-number"},[t._v("34")]),a("br"),a("span",{staticClass:"line-number"},[t._v("35")]),a("br"),a("span",{staticClass:"line-number"},[t._v("36")]),a("br"),a("span",{staticClass:"line-number"},[t._v("37")]),a("br"),a("span",{staticClass:"line-number"},[t._v("38")]),a("br"),a("span",{staticClass:"line-number"},[t._v("39")]),a("br"),a("span",{staticClass:"line-number"},[t._v("40")]),a("br"),a("span",{staticClass:"line-number"},[t._v("41")]),a("br"),a("span",{staticClass:"line-number"},[t._v("42")]),a("br")])]),a("h2",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://developer.apple.com/reference/foundation/nshttpcookiestorage",target:"_blank",rel:"noopener noreferrer"}},[t._v("NSHTTPCookieStorage"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://developer.apple.com/library/prerelease/content/documentation/Cocoa/Conceptual/URLLoadingSystem/CookiesandCustomProtocols/CookiesandCustomProtocols.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Cookies and Custom Protocols"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"http://geeklu.com/2013/04/ios-cookie/",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://geeklu.com/2013/04/ios-cookie/"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"http://blog.it985.com/11248.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://blog.it985.com/11248.html"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("em",[t._v("《HTTP 权威指南》第11章 客户端识别与cookie机制")])]),t._v(" "),a("h2",{attrs:{id:"相关导引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#相关导引"}},[t._v("#")]),t._v(" 相关导引")]),t._v(" "),a("p",[t._v("解决UIWebView和WKWebView之间的cookie共享问题：")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://fengqiangboy.com/14611518603473.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("iOS开发-打通UIWebView和WKWebView的Cookie"),a("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=n.exports}}]);