(window.webpackJsonp=window.webpackJsonp||[]).push([[68],{324:function(n,s,t){"use strict";t.r(s);var a=t(0),e=Object(a.a)({},(function(){var n=this,s=n.$createElement,t=n._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[t("p",[n._v("dynu更新ip的服务尽然被Q了, 使用代理进行更新ip，但更新的是代理服务器的ip地址。")]),n._v(" "),t("p",[n._v("基于以上的矛盾点，我想到的解决思路是：")]),n._v(" "),t("ol",[t("li",[n._v("不使用代理获取真实的公网IP并保存到变量")]),n._v(" "),t("li",[n._v("设置代理")]),n._v(" "),t("li",[n._v("将真实IP变量手动更新到dynu服务")]),n._v(" "),t("li",[n._v("定时执行此脚本")])]),n._v(" "),t("p",[n._v("前3步具体实现如下")]),n._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('#!/bin/bash\n\necho $SHELL\n\n#验证拿到的真实IP是否合法\nfunction isValideIP() {\n\tregex="\\b(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[1-9])\\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[1-9])\\b"\n\tckStep2=`echo $1 | egrep $regex | wc -l`\n\tif [ $ckStep2 -eq 0 ]\n\tthen\n\t\techo 0\n\telse\n\t    echo 1\n\tfi\n}\n\n#用于获取真实IP的服务，由于是些三方的服务，添加多个避免其中某个失效\npaths=("whatismyip.akamai.com" "ifconfig.me" "icanhazip.com" "ident.me" "ipecho.net/plain" "myip.dnsomatic.com")\ncount=${#paths[*]} \nindex=0\nwhile [ $index -lt $count ];\ndo\n\tunset all_proxy\n\tip=`curl --connect-timeout 5 -m 5 ${paths[$index]}`\n\techo "using ${paths[$index]}"\n\tres=$(isValideIP $ip)\n\tif [ $res -eq 1 ]; then\n\t\techo "ipaddr: $ip"\n\t\ttime=$(date "+%Y-%m-%d %H:%M:%S")\n\t\techo $time\n\t\texport all_proxy=socks5://127.0.0.1:1086\n\t\techo `curl "https://api.dynu.com/nice/update?username=yourusername&password=yourpwd&hostname=your_domain&myip=$ip"`\n\t\tlet index=count\n\telse\n\t\techo "fail"\n\t\tlet index+=1\n\tfi\ndone\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br"),t("span",{staticClass:"line-number"},[n._v("17")]),t("br"),t("span",{staticClass:"line-number"},[n._v("18")]),t("br"),t("span",{staticClass:"line-number"},[n._v("19")]),t("br"),t("span",{staticClass:"line-number"},[n._v("20")]),t("br"),t("span",{staticClass:"line-number"},[n._v("21")]),t("br"),t("span",{staticClass:"line-number"},[n._v("22")]),t("br"),t("span",{staticClass:"line-number"},[n._v("23")]),t("br"),t("span",{staticClass:"line-number"},[n._v("24")]),t("br"),t("span",{staticClass:"line-number"},[n._v("25")]),t("br"),t("span",{staticClass:"line-number"},[n._v("26")]),t("br"),t("span",{staticClass:"line-number"},[n._v("27")]),t("br"),t("span",{staticClass:"line-number"},[n._v("28")]),t("br"),t("span",{staticClass:"line-number"},[n._v("29")]),t("br"),t("span",{staticClass:"line-number"},[n._v("30")]),t("br"),t("span",{staticClass:"line-number"},[n._v("31")]),t("br"),t("span",{staticClass:"line-number"},[n._v("32")]),t("br"),t("span",{staticClass:"line-number"},[n._v("33")]),t("br"),t("span",{staticClass:"line-number"},[n._v("34")]),t("br"),t("span",{staticClass:"line-number"},[n._v("35")]),t("br"),t("span",{staticClass:"line-number"},[n._v("36")]),t("br"),t("span",{staticClass:"line-number"},[n._v("37")]),t("br"),t("span",{staticClass:"line-number"},[n._v("38")]),t("br")])]),t("p",[n._v("注意执行 shell 脚本用的 zsh 还是 bash，因为要涉及到设置到代理和取消代理。")]),n._v(" "),t("p",[n._v("第4步可以使用 cron 命令或者是 mac 的 launchctl 来创建定时操作任务，不在本文中介绍。")]),n._v(" "),t("p",[n._v("Mac中使用 launchctl 的流程可以查看 "),t("a",{attrs:{href:"http://www.yangjie.hu/2019/07/16/launchctl-in-mac/",target:"_blank",rel:"noopener noreferrer"}},[n._v("Mac 创建定时任务"),t("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=e.exports}}]);