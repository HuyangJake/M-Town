(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{349:function(e,s,t){"use strict";t.r(s);var a=t(0),n=Object(a.a)({},(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h2",{attrs:{id:"getting-around-rootless"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#getting-around-rootless"}},[e._v("#")]),e._v(" Getting around Rootless")]),e._v(" "),t("p",[e._v("OS X 10.11 中引入的 Rootless，即使是root用户，也无法对以下路径有写和执行的权限：")]),e._v(" "),t("pre",[t("code",[e._v("/System\n/bin\n/sbin\n/usr (except /usr/local)\n只有Apple自身签名的软件（含命令行工具）可以。\n")])]),e._v(" "),t("p",[e._v("Apple的Rootless机制虽然保护了系统的安全，防止了大部分恶意软件想通过单纯的引导用户，输入自己的密码点击确定来直接切换到root做一些违法的事情。也可以防止黑客黑了一个用户然后就有root权限可以肆意妄为的情况，不过对于真正的黑客来说")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://pic2.zhimg.com/e3a51869c1a65e3cb56378470b5af695_b.jpg",alt:""}})]),e._v(" "),t("h2",{attrs:{id:"disabling-rootless"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#disabling-rootless"}},[e._v("#")]),e._v(" Disabling Rootless")]),e._v(" "),t("p",[e._v("在电脑的Recovery Mode，打开终端输入")]),e._v(" "),t("pre",[t("code",[e._v("csrutil disable; reboot\n")])]),e._v(" "),t("p",[e._v("电脑会重启，此时电脑就禁用了Rootless，可以调试系统级别的应用。")]),e._v(" "),t("p",[e._v("可以使用命令：")]),e._v(" "),t("pre",[t("code",[e._v("lldb -n Finder\n")])]),e._v(" "),t("p",[e._v("看到类似以下信息就表示成功")]),e._v(" "),t("pre",[t("code",[e._v("Process XXX stoped\n.\n.\n.\n")])]),e._v(" "),t("h2",{attrs:{id:"attaching-lldb-to-xcode"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#attaching-lldb-to-xcode"}},[e._v("#")]),e._v(" Attaching LLDB to Xcode")]),e._v(" "),t("p",[e._v("使用"),t("code",[e._v("lldb")]),e._v(" attach 到最常用的工具Xcode！")]),e._v(" "),t("p",[e._v("方式一：")]),e._v(" "),t("pre",[t("code",[e._v("lldb file /Applications/Xcode.app/Contents/MacOS/Xcode\n")])]),e._v(" "),t("p",[e._v("方式二：")]),e._v(" "),t("pre",[t("code",[e._v("lldb -n Xcode  //需要Xcode在运行状态\n")])]),e._v(" "),t("p",[e._v("方式三：")]),e._v(" "),t("pre",[t("code",[e._v("pgrep -x Xcode  //需要Xcode在运行状态\nlldb -p 89921 //89921为Xcode的PID\n")])]),e._v(" "),t("p",[e._v("方式四：(attaching 一个将会运行的程序)")]),e._v(" "),t("pre",[t("code",[e._v("lldb -n Finder -w\n\npkill Finder\n")])]),e._v(" "),t("p",[e._v("运行程序：")]),e._v(" "),t("pre",[t("code",[e._v("process lanuch -e /dev/ttys004 --\n")])]),e._v(" "),t("p",[e._v("这里的"),t("code",[e._v("ttys004")]),e._v("是shell中的某个tab的唯一id")]),e._v(" "),t("hr"),e._v(" "),t("h3",{attrs:{id:"运行程序时可以携带的参数："}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行程序时可以携带的参数："}},[e._v("#")]),e._v(" 运行程序时可以携带的参数：")]),e._v(" "),t("ul",[t("li",[e._v("通过"),t("code",[e._v("-w")]),e._v("参数改变运行程序的目录：")])]),e._v(" "),t("div",{staticClass:"language-lldb line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("(lldb) process launch -w /Applications\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("ul",[t("li",[e._v("也可以直接将参数加到程序后面：")])]),e._v(" "),t("div",{staticClass:"language-lldb line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("(lldb) process launch -- /Applications\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("ul",[t("li",[t("code",[e._v("-X")]),e._v("参数让 "),t("code",[e._v("shell")]),e._v(" 接受任何格式参数，比如下面这种 "),t("code",[e._v("~")]),e._v(" 字符")])]),e._v(" "),t("div",{staticClass:"language-lldb line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("(lldb) process launch -X true -- ~/Desktop\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("ps： "),t("code",[e._v("run")]),e._v(" 命令是上面 "),t("code",[e._v("process launch -X true --")]),e._v(" 的简写")]),e._v(" "),t("p",[e._v("可以直接  "),t("code",[e._v("run ~/Desktop")])]),e._v(" "),t("ul",[t("li",[t("code",[e._v("-o")]),e._v(" 命令让LLDB输出到指定的文件")])]),e._v(" "),t("div",{staticClass:"language-lldb line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("(lldb) process launch -o /tmp/ls_output.txt -- /Applications\n\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("ul",[t("li",[t("code",[e._v("-i")]),e._v(" 命令可以从外部文件读取数据，这在不想stdin的状况下很有用（还没有体会到😌 ）")])]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("(lldb) process launch -i /tmp/wc_input.txt\n\n等同于\nwc < /tmp/wc_input.txt  //wc为当前lldb的target\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br")])]),t("ul",[t("li",[t("code",[e._v("-n")]),e._v(" 命令告诉LLDB不要创建stdin")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("(lldb) process launch -n\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("hr"),e._v(" "),t("p",[e._v("按"),t("code",[e._v("Ctrl + C")]),e._v("可以暂停debugger， 添加一个断点：")]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('breakpoint set -n "-[NSView hitTest:]"\t\ncontinue //断点后继续执行\npo $rdi // 查看RDI CPU register\t\n//修改一个断点，添加一个触发条件\nbreakpoint modify 1 -c "(BOOL)[$rdi isKindOfClass:[NSTextView class]]" \n\t\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br")])]),t("p",[e._v("内容出处：\n"),t("strong",[e._v("《Advanced Apple Debugging & Reverse Engineering》")])])])}),[],!1,null,null,null);s.default=n.exports}}]);